<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<title>Dashboard Stream</title>
<style>
body{font-family:Arial;margin:24px;max-width:760px}
label{display:block;margin-top:12px}
input{width:100%;padding:8px;margin-top:6px}
button{margin-top:12px;padding:10px 14px}
</style>
</head>
<body>
<h2>Dashboard Stream (WIB â†’ UTC Otomatis)</h2>

<label>GitHub Token (PAT)
<input id="pat" placeholder="Masukkan token"/>
</label>

<label>Repository (owner/repo)
<input id="repo" placeholder="rigusapp/yt_stream"/>
</label>

<label>Workflow file
<input id="workflow" value="stream.yml"/>
</label>

<label>Video URL
<input id="video" placeholder="https://.../video.mp4"/>
</label>

<label>Waktu Mulai (WIB)
<input id="start" type="datetime-local"/>
</label>

<label>Durasi (detik)
<input id="duration" value="3600" type="number"/>
</label>

<button id="startBtn">Trigger Stream</button>
<div id="log"></div>

<script>
function toUTC(wibString){
    const local = new Date(wibString);
    const utc = new Date(local.getTime() - (7*60*60*1000));
    return utc.toISOString().split('.')[0] + "Z";
}

async function callAPI(url, opts){
  const res = await fetch(url, opts);
  const txt = await res.text();
  try { return {ok:res.ok, json: JSON.parse(txt), text: txt}; } catch(e){ return {ok:res.ok, text:txt}; }
}

document.getElementById('startBtn').onclick = async ()=>{
  const token=document.getElementById('pat').value.trim();
  const repo=document.getElementById('repo').value.trim();
  const wf=document.getElementById('workflow').value.trim();
  const video=document.getElementById('video').value.trim();
  const start=document.getElementById('start').value.trim();
  const duration=document.getElementById('duration').value.trim();
  const log=document.getElementById('log');

  if(!token||!repo||!wf||!video||!start){alert("Lengkapi semua data");return;}

  const utcTime = toUTC(start);
  const [owner,name]=repo.split('/');

  const body={
    ref:"main",
    inputs:{ video_url:video, start_time:utcTime, duration_seconds:duration }
  };

  const url=`https://api.github.com/repos/${owner}/${name}/actions/workflows/${wf}/dispatches`;

  const r = await callAPI(url,{
    method:"POST",
    headers:{
      Authorization:"token "+token,
      Accept:"application/vnd.github.v3+json",
      "Content-Type":"application/json"
    },
    body:JSON.stringify(body)
  });

  log.innerHTML = r.ok ? "<p style='color:green'>Workflow dijalankan.</p>" : "<pre style='color:red'>"+r.text+"</pre>";
};
</script>
</body>
</html>
