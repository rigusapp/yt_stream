<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>YT Stream Dashboard</title>
<style>
body{font-family:sans-serif;padding:20px;}
table{border-collapse:collapse;width:100%;}
th,td{border:1px solid #ccc;padding:8px;}
.btn{padding:6px 10px;border-radius:4px;}
.btn-danger{background:#e74c3c;color:#fff;border:0;}
.btn-primary{background:#3498db;color:#fff;border:0;}
</style>
</head>
<body>
<h1>YT Stream â€” Dashboard</h1>

<h2>Buat Jadwal</h2>
<label>Judul<br><input id="title"></label><br>
<label>Datetime<br><input id="datetime" placeholder="YYYY-MM-DDTHH:MM:SS"></label><br>
<label>Sumber<br><input id="source"></label><br>
<label>Durasi (menit)<br><input id="duration" type="number" value="30"></label><br>
<label>Looping<br>
<select id="looping">
<option value="false">Tidak</option>
<option value="true">Ya</option>
</select></label><br>
<button class="btn btn-primary" onclick="create()">Simpan</button>

<h2>Daftar Live</h2>
<table>
<thead><tr>
<th>Judul</th><th>Datetime</th><th>Sumber</th><th>Durasi</th><th>Looping</th><th>Status</th><th>Aksi</th>
</tr></thead>
<tbody id="body"></tbody>
</table>

<script>
async function load(){
 let r=await fetch("/streams"); let d=await r.json();
 let b=document.getElementById("body"); b.innerHTML="";
 d.forEach(x=>{
  let tr=document.createElement("tr");
  tr.innerHTML=`<td>${x.title}</td>
<td>${x.datetime}</td>
<td>${x.source}</td>
<td>${x.duration}</td>
<td>${x.looping?"Ya":"Tidak"}</td>
<td>${x.status}</td>
<td>
<button onclick="startNow('${x.id}')">Start</button>
<button class='btn btn-danger' onclick="stopNow('${x.id}')">Stop</button>
<button onclick="delNow('${x.id}')">Hapus</button>
</td>`;
 b.appendChild(tr);
 });
}
async function create(){
 let body={title:val("title"),datetime:val("datetime"),source:val("source"),
 duration:Number(val("duration")),looping:val("looping")==="true"};
 await fetch("/schedule",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
 load();
}
function val(id){return document.getElementById(id).value;}
async function startNow(id){await fetch("/start?id="+id,{method:"POST"});load();}
async function stopNow(id){await fetch("/stop?id="+id,{method:"POST"});load();}
async function delNow(id){await fetch("/delete-stream?id="+id,{method:"POST"});load();}
setInterval(load,5000); load();
</script>
</body>
</html>
