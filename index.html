<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<title>Dashboard Stream v12 — Cloudflare Worker Proxy</title>
<style>
body{font-family:Arial,system-ui;margin:20px auto;max-width:880px;padding:12px}
h2{margin-bottom:6px}
label{display:block;margin-top:12px;font-weight:600}
input, select, button{width:100%;padding:10px;margin-top:6px;font-size:15px;box-sizing:border-box}
button{cursor:pointer}
.note{font-size:13px;color:#444;margin-top:8px}
.success{color:green}
.error{color:#b00020;white-space:pre-wrap}
pre{background:#f6f6f6;padding:10px;border-radius:6px;overflow:auto}
.row{display:flex;gap:10px}
.col{flex:1}
.small{max-width:220px}
</style>
</head>
<body>
<h2>Dashboard Stream v12 — Cloudflare Worker Proxy</h2>
<p class="note">Pastikan Worker sudah dideploy dan GH_PAT tersimpan di Worker variables. Masukkan URL Worker di bawah.</p>

<label>URL Cloudflare Worker</label>
<input id="worker" value="https://ytstream-proxy.rigus-apps.workers.dev/" />

<label>Video URL</label>
<input id="video" placeholder="https://.../video.mp4"/>

<label>Tanggal & Jam Live (WIB)</label>
<input id="datetime" type="datetime-local"/>

<label>Durasi</label>
<select id="duration">
  <option value="1800">30 Menit</option>
  <option value="3600" selected>1 Jam</option>
  <option value="7200">2 Jam</option>
  <option value="10800">3 Jam</option>
  <option value="14400">4 Jam</option>
  <option value="18000">5 Jam</option>
  <option value="21600">6 Jam</option>
  <option value="25200">7 Jam</option>
  <option value="28800">8 Jam</option>
  <option value="32400">9 Jam</option>
  <option value="36000">10 Jam</option>
  <option value="39600">11 Jam</option>
  <option value="43200">12 Jam</option>
</select>

<label><input type="checkbox" id="seamless"/> Seamless Loop (tanpa putus)</label>

<button id="startBtn">Kirim ke Worker</button>

<div id="log" style="margin-top:14px"></div>
<pre id="resp" style="display:none"></pre>

<script>
function convertWIBToUTC(datetimeLocal){
    const local = new Date(datetimeLocal);
    const utc = new Date(local.getTime() - (7*60*60*1000));
    return utc.toISOString().split('.')[0] + "Z";
}

async function call(url, opts){
    const res = await fetch(url, opts);
    const text = await res.text();
    return {ok: res.ok, status: res.status, text};
}

document.getElementById("startBtn").onclick = async ()=>{
    const worker = document.getElementById("worker").value.trim();
    const video = document.getElementById("video").value.trim();
    const datetime = document.getElementById("datetime").value.trim();
    const duration = document.getElementById("duration").value;
    const seamless = document.getElementById("seamless").checked;
    const log = document.getElementById("log");
    const resp = document.getElementById("resp");

    if(!worker || !video || !datetime){
        alert("Lengkapi semua data!");
        return;
    }

    const utc = convertWIBToUTC(datetime);

    const payload = {
        repo: "rigusapp/yt_stream",
        video_url: video,
        start_time: utc,
        duration_seconds: duration,
        seamless: seamless ? "true" : "false"
    };

    log.innerHTML="Mengirim ke Worker…";
    resp.style.display="none";
    try{
      const r = await call(worker, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "User-Agent": "dashboard-v12-client"
        },
        body: JSON.stringify(payload)
      });
      if(r.ok){
        log.innerHTML = "<p class='success'>Berhasil: status "+r.status+"</p>";
      } else {
        log.innerHTML = "<p class='error'>Gagal: status "+r.status+"</p>";
      }
      resp.style.display="block";
      resp.textContent = "Response body:\n" + r.text;
    } catch(e){
      log.innerHTML = "<p class='error'>Fetch error: "+e.message+"</p>";
    }
};
</script>
</body>
</html>
