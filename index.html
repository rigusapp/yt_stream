<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<title>YT Stream — Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
body{margin:0;font-family:Arial;background:#020617;color:#e5e7eb}
.container{max-width:900px;margin:30px auto;background:#030712;border-radius:16px;padding:20px;border:1px solid #1f2937}
label{display:block;margin-top:12px;font-weight:bold}
input,select,textarea{
  width:100%;margin-top:6px;padding:10px;
  background:#020617;border:1px solid #1f2937;
  color:white;border-radius:10px
}
textarea{min-height:80px}
.row{display:flex;gap:10px;flex-wrap:wrap}
button{
  margin-top:14px;padding:10px 16px;border-radius:20px;
  border:0;font-weight:bold;cursor:pointer
}
.start{background:#22c55e;color:black}
.stop{background:#ef4444;color:white}
.test{background:#2563eb;color:white}
.log{
  margin-top:16px;background:#020617;border:1px solid #1f2937;
  padding:12px;border-radius:10px;
  font-family:monospace;font-size:12px;
  white-space:pre-wrap;max-height:250px;overflow:auto
}
</style>
</head>
<body>

<div class="container">
  <h2>YT Stream — Dashboard</h2>

  <label>Cloudflare Worker URL (HTTP)</label>
  <input id="workerUrl" placeholder="http://xxxx.workers.dev">

  <div class="row">
    <div style="flex:1">
      <label>RTMP Server</label>
      <input id="rtmp" value="rtmp://a.rtmp.youtube.com/live2">
    </div>
    <div style="flex:1">
      <label>Stream Key</label>
      <input id="streamKey" type="password">
    </div>
  </div>

  <label>Video URL</label>
  <input id="video">

  <label>Judul</label>
  <input id="title">

  <label>Deskripsi</label>
  <textarea id="description"></textarea>

  <label>Visibility</label>
  <select id="visibility">
    <option value="public">Public</option>
    <option value="unlisted">Unlisted</option>
    <option value="private">Private</option>
  </select>

  <div class="row">
    <button class="start" id="btnStart">▶ START STREAM</button>
    <button class="stop" id="btnStop">■ STOP STREAM</button>
    <button class="test" id="btnTest">TEST</button>
  </div>

  <div class="log" id="log">[INFO] Menunggu aksi...</div>
</div>

<script>
function log(msg){
  const el = document.getElementById("log");
  const t = new Date().toLocaleTimeString();
  el.textContent += "\n[" + t + "] " + msg;
  el.scrollTop = el.scrollHeight;
}

async function postJSON(url,data){
  const r = await fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });
  const text = await r.text();
  return {status:r.status, text:text, ok:r.ok};
}

// ✅ START STREAM (TIDAK BERUBAH)
btnStart.onclick = async ()=>{
  const worker = workerUrl.value.trim();

  try{
    log("Mengirim START ke Worker...");
    const r = await postJSON(worker, {
      video_url: video.value.trim(),
      rtmp_url: rtmp.value.trim(),
      title: title.value.trim(),
      description: description.value.trim(),
      visibility: visibility.value,
      stream_key: streamKey.value.trim()
    });
    log("START: " + r.status + " | " + r.text);
  }catch(e){
    log("START ERROR: " + e.message);
  }
};

// ✅ STOP STREAM (TAMBAHAN BARU)
btnStop.onclick = async ()=>{
  const worker = workerUrl.value.trim();

  try{
    log("Mengirim STOP ke Worker...");
    const r = await postJSON(worker + "/stop", {});
    log("STOP: " + r.status + " | " + r.text);
  }catch(e){
    log("STOP ERROR: " + e.message);
  }
};

// ✅ TEST WORKER
btnTest.onclick = async ()=>{
  const worker = workerUrl.value.trim();
  try{
    const r = await fetch(worker, {method:"OPTIONS"});
    log("TEST: " + r.status);
  }catch(e){
    log("TEST ERROR: " + e.message);
  }
};
</script>

</body>
</html>
