<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<title>YT Stream Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&display=swap" rel="stylesheet">
<style>
    :root{--bg:#f5f7fb;--card:#ffffff;--accent:#ff0000;--muted:#6b7280}
    body{font-family:'Inter',Arial,system-ui;background:var(--bg);margin:0;display:flex;justify-content:center;padding:40px 12px}
    .container{width:100%;max-width:820px;background:var(--card);border-radius:16px;padding:28px;box-shadow:0 10px 30px rgba(16,24,40,0.08)}
    .header{display:flex;gap:14px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;flex:0 0 56px;background:linear-gradient(135deg,#ff3b30,#c40000);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:22px}
    h1{margin:0;font-size:22px}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px}
    label{display:block;font-weight:600;font-size:13px;color:#111;margin-top:10px}
    input, select, textarea{width:100%;padding:11px;border-radius:8px;border:1px solid #e6e9ef;background:#fbfdff;box-sizing:border-box;font-size:14px}
    textarea{min-height:100px;resize:vertical}
    .full{grid-column:1/3}
    .actions{display:flex;gap:12px;margin-top:18px}
    button.primary{flex:1;background:var(--accent);color:#fff;padding:12px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #e6e9ef;padding:12px;border-radius:10px;cursor:pointer}
    .note{font-size:13px;color:var(--muted);margin-top:10px}
    pre{background:#0b1220;color:#bfe7b0;padding:12px;border-radius:8px;margin-top:12px;display:none;overflow:auto}
    .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo" aria-hidden="true">YT</div>
    <div>
      <h1>YT Stream Premium</h1>
      <p class="lead">Aplikasi streaming otomatis — masukkan data lalu klik Mulai Streaming.</p>
    </div>
  </div>

  <div class="grid">
    <div class="full">
      <label>Judul Video</label>
      <input id="title" placeholder="Contoh: Live Musik Santai">
    </div>

    <div>
      <label>Visibilitas</label>
      <select id="visibility">
        <option value="public">Public</option>
        <option value="unlisted">Unlisted</option>
        <option value="private">Private</option>
      </select>
    </div>

    <div>
      <label>Stream Key (YouTube)</label>
      <input id="streamKey" placeholder="xxxx-xxxx-xxxx...">
      <div class="small">Stream Key akan dipakai langsung oleh runner. Jangan bagikan ke orang lain.</div>
    </div>

    <div class="full">
      <label>Deskripsi</label>
      <textarea id="description" placeholder="Deskripsi singkat tentang livestream..."></textarea>
    </div>

    <div class="full">
      <label>Video URL</label>
      <input id="video" placeholder="https://.../video.mp4">
    </div>

    <div>
      <label>Tanggal & Jam Live (WIB)</label>
      <input id="datetime" type="datetime-local">
    </div>

    <div>
      <label>Durasi</label>
      <select id="duration">
        <option value="1800">30 Menit</option>
        <option value="3600" selected>1 Jam</option>
        <option value="7200">2 Jam</option>
        <option value="10800">3 Jam</option>
        <option value="14400">4 Jam</option>
        <option value="18000">5 Jam</option>
        <option value="21600">6 Jam</option>
        <option value="25200">7 Jam</option>
        <option value="28800">8 Jam</option>
        <option value="32400">9 Jam</option>
        <option value="36000">10 Jam</option>
        <option value="39600">11 Jam</option>
        <option value="43200">12 Jam</option>
      </select>
    </div>

    <div>
      <label>Seamless Loop</label>
      <select id="seamless">
        <option value="true">Ya</option>
        <option value="false" selected>Tidak</option>
      </select>
    </div>
  </div>

  <div class="actions">
    <button class="primary" id="startBtn">Mulai Streaming</button>
    <button class="ghost" id="clearBtn">Bersihkan</button>
  </div>

  <div class="note">Catatan: Judul, deskripsi, dan visibilitas hanya dikirim ke workflow. Untuk mengubah metadata di YouTube (title/description/visibility) secara resmi, perlu integrasi YouTube Data API (OAuth) — belum otomatis di sini.</div>
  <pre id="resp"></pre>
  <div id="log" class="note"></div>
</div>

<script>
const WORKER_URL = "https://ytstream-proxy.rigus-apps.workers.dev/";

// convert WIB to UTC ISO
function convertWIBToUTC(datetimeLocal){
    const local = new Date(datetimeLocal);
    const utc = new Date(local.getTime() - 7*60*60*1000);
    return utc.toISOString().split('.')[0] + "Z";
}

async function post(url, body){
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json", "User-Agent": "premium-v15-client" },
      body: JSON.stringify(body)
    });
    const text = await res.text();
    return {ok: res.ok, status: res.status, text};
}

document.getElementById("clearBtn").onclick = ()=>{
  document.getElementById("title").value = "";
  document.getElementById("description").value = "";
  document.getElementById("streamKey").value = "";
  document.getElementById("video").value = "";
  document.getElementById("datetime").value = "";
  document.getElementById("duration").value = "3600";
  document.getElementById("visibility").value = "public";
  document.getElementById("seamless").value = "false";
  document.getElementById("log").textContent = "";
  document.getElementById("resp").style.display = "none";
};

document.getElementById("startBtn").onclick = async ()=>{
  const title = document.getElementById("title").value.trim();
  const visibility = document.getElementById("visibility").value;
  const description = document.getElementById("description").value.trim();
  const streamKey = document.getElementById("streamKey").value.trim();
  const video = document.getElementById("video").value.trim();
  const datetime = document.getElementById("datetime").value.trim();
  const duration = document.getElementById("duration").value;
  const seamless = document.getElementById("seamless").value;

  const log = document.getElementById("log");
  const resp = document.getElementById("resp");

  if(!streamKey){
    alert("Stream Key wajib diisi.");
    return;
  }
  if(!video || !datetime){
    alert("Lengkapi video & tanggal.");
    return;
  }

  const payload = {
    repo: "rigusapp/yt_stream",
    title, visibility, description, stream_key: streamKey,
    video_url: video,
    start_time: convertWIBToUTC(datetime),
    duration_seconds: duration,
    seamless: seamless === "true" ? "true" : "false"
  };

  log.textContent = "Mengirim ke Worker...";
  resp.style.display = "none";

  try{
    const r = await post(WORKER_URL, payload);
    if(r.ok){
      log.textContent = "Berhasil dikirim. Status: " + r.status;
    } else {
      log.textContent = "Gagal: " + r.status + " — lihat response di bawah.";
    }
    resp.style.display = "block";
    resp.textContent = r.text;
  }catch(e){
    log.textContent = "Fetch error: "+e.message;
  }
};
</script>
</body>
</html>
