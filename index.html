<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <title>YT Stream â€” Dashboard</title>
  <style>
    body{font-family:Inter, Arial, sans-serif;max-width:900px;margin:24px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px}
    header img{width:64px;height:64px}
    h1{margin:0;font-size:28px}
    label{display:block;margin-top:14px;font-weight:600}
    input, select, textarea{width:100%;padding:10px;margin-top:6px;border:1px solid #ccc;border-radius:6px}
    button{margin-top:14px;padding:12px 16px;border-radius:8px;border:0;background:#ff0000;color:#fff;font-weight:700}
    .muted{color:#666;font-size:13px;margin-top:6px}
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="YT Stream logo"/>
    <div>
      <h1>YT Stream</h1>
      <div class="muted">Premium dashboard</div>
    </div>
  </header>

  <p class="muted">Isi data stream dan Masukkan Stream Key (Youtube Anda). Streaming akan Otomatis dijalankan</p>

  <label>URL Cloudflare Worker
    <input id="workerUrl" placeholder="https://ytstream-proxy.example.workers.dev/"/>
  </label>

  <label>Video URL
    <input id="video" placeholder="https://example.com/video.mp4"/>
  </label>

  <label>Tanggal & Jam Live (WIB)
    <input id="datetime" type="datetime-local"/>
  </label>

  <label>Durasi
    <select id="duration">
      <option>30 menit</option>
      <option selected>1 Jam</option>
      <option>2 Jam</option>
      <option>3 Jam</option>
      <option>4 Jam</option>
      <option>5 Jam</option>
      <option>6 Jam</option>
      <option>7 Jam</option>
      <option>8 Jam</option>
      <option>9 Jam</option>
      <option>10 Jam</option>
      <option>11 Jam</option>
      <option>12 Jam</option>
    </select>
  </label>

  <label>Judul Video
    <input id="title" placeholder="Judul live"/>
  </label>

  <label>Deskripsi
    <textarea id="desc" rows="3" placeholder="Deskripsi video"></textarea>
  </label>

  <label>Visibilitas
    <select id="visibility">
      <option value="public">Publik</option>
      <option value="unlisted">Unlisted</option>
      <option value="private">Private</option>
    </select>
  </label>

  <label>Stream Key</label>
  <input id="streamKey" placeholder="rmfk-xxxxx-xxxxx" />

  <button id="trigger">Jalankan Stream</button>

  <div id="log" class="muted"></div>

  <script>
    function wibToUTCISOString(dtLocal) {
      // dtLocal is like "2025-12-01T15:30"
      const local = new Date(dtLocal);
      // WIB is UTC+7, but local input is treated as local timezone in browser.
      // convert: assume user selected WIB, so subtract 7 hours to get UTC
      const utc = new Date(local.getTime() - (7*60*60*1000));
      return utc.toISOString();
    }

    document.getElementById('trigger').onclick = async () => {
      const url = document.getElementById('workerUrl').value.trim();
      const video = document.getElementById('video').value.trim();
      const dt = document.getElementById('datetime').value.trim();
      const duration = document.getElementById('duration').value;
      const title = document.getElementById('title').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const visibility = document.getElementById('visibility').value;
      const streamKey = document.getElementById('streamKey').value.trim();
      const log = document.getElementById('log');

      if (!url || !video || !dt || !streamKey) {
        alert('Lengkapi URL Worker, video, tanggal, dan stream key.');
        return;
      }

      // duration to seconds (simple mapping)
      const durMap = {'30 menit':1800,'1 Jam':3600,'2 Jam':7200,'3 Jam':10800,'4 Jam':14400,'5 Jam':18000,
                      '6 Jam':21600,'7 Jam':25200,'8 Jam':28800,'9 Jam':32400,'10 Jam':36000,'11 Jam':39600,'12 Jam':43200};
      const durSeconds = durMap[duration] || 3600;

      const payload = {
        video_url: video,
        start_time: wibToUTCISOString(dt),
        duration_seconds: String(durSeconds),
        stream_key: streamKey,
        title: title,
        description: desc,
        visibility: visibility,
        seamless: "false"
      };

      log.textContent = 'Mengirim ke Worker...';
      try {
        const res = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
        const txt = await res.text();
        if (res.ok) {
          log.textContent = 'Berhasil dikirim. Response: ' + txt;
        } else {
          log.textContent = 'Gagal: ' + res.status + ' ' + txt;
        }
      } catch(err){ log.textContent = 'Error: '+err.message; }
    }
  </script>
</body>
</html>
