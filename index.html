<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<title>Dashboard Stream — Versi Minimal + Durasi List</title>

<style>
body{font-family:Arial;margin:24px;max-width:760px}
label{display:block;margin-top:12px;font-weight:bold}
input, select{width:100%;padding:10px;margin-top:6px;font-size:16px}
button{margin-top:20px;padding:12px 16px;width:100%;font-size:18px;cursor:pointer}
</style>
</head>

<body>

<h2>Dashboard Stream — Minimal + Durasi List</h2>

<label>GitHub Token (PAT)</label>
<input id="pat" placeholder="Masukkan token"/>

<label>Repository (owner/repo)</label>
<input id="repo" placeholder="rigusapp/yt_stream"/>

<label>Workflow file</label>
<input id="workflow" value="stream.yml"/>

<label>Video URL</label>
<input id="video" placeholder="https://.../video.mp4"/>

<label>Tanggal & Jam Live (WIB)</label>
<input id="datetime" type="datetime-local">

<label>Durasi Live</label>
<select id="duration">
  <option value="1800">30 Menit</option>
  <option value="3600">1 Jam</option>
  <option value="7200">2 Jam</option>
  <option value="10800">3 Jam</option>
  <option value="14400">4 Jam</option>
  <option value="18000">5 Jam</option>
  <option value="21600">6 Jam</option>
  <option value="25200">7 Jam</option>
  <option value="28800">8 Jam</option>
  <option value="32400">9 Jam</option>
  <option value="36000">10 Jam</option>
  <option value="39600">11 Jam</option>
  <option value="43200">12 Jam</option>
</select>

<label>
<input type="checkbox" id="loop"> Seamless Loop (tanpa putus)
</label>

<button id="startBtn">Trigger Stream</button>
<div id="log" style="margin-top:20px;"></div>

<script>
// Convert datetime-local WIB → UTC
function convertWIBToUTC(datetimeLocal){
    const local = new Date(datetimeLocal);
    const utc = new Date(local.getTime() - (7*60*60*1000));
    return utc.toISOString().split('.')[0] + "Z";
}

async function callAPI(url, opts){
  const res = await fetch(url, opts);
  const txt = await res.text();
  try { return {ok:res.ok, json:JSON.parse(txt), text:txt}; } catch(e){ return {ok:res.ok, text:txt}; }
}

document.getElementById("startBtn").onclick = async ()=>{

  const token=document.getElementById("pat").value.trim();
  const repo=document.getElementById("repo").value.trim();
  const wf=document.getElementById("workflow").value.trim();
  const video=document.getElementById("video").value.trim();
  const datetime=document.getElementById("datetime").value.trim();
  const duration=parseInt(document.getElementById("duration").value);
  const seamless=document.getElementById("loop").checked;

  const log=document.getElementById("log");

  if(!token||!repo||!wf||!video||!datetime){
    alert("Lengkapi semua data!");
    return;
  }

  const utcTime = convertWIBToUTC(datetime);
  const [owner,name]=repo.split("/");

  const body = {
    ref:"main",
    inputs:{
      video_url: video,
      start_time: utcTime,
      duration_seconds: String(duration),
      seamless: seamless ? "true" : "false"
    }
  };

  const url=`https://api.github.com/repos/${owner}/${name}/actions/workflows/${wf}/dispatches`;

  const r = await callAPI(url,{
    method:"POST",
    headers:{
      Authorization:"token "+token,
      Accept:"application/vnd.github.v3+json",
      "Content-Type":"application/json"
    },
    body:JSON.stringify(body)
  });

  log.innerHTML = r.ok
    ? "<p style='color:green'>Workflow dijalankan.</p>"
    : "<pre style='color:red'>"+r.text+"</pre>";
};
</script>

</body>
</html>
